import ImageComponent from"/components/image-component.mjs";import VideoComponent from"/components/video-component.mjs";import ComboComponent from"/components/combo-component.mjs";import TextComponent from"/components/text-component.mjs";import Loader from"/components/loader-component.mjs";const postButton=document.getElementById("postButton"),postText=document.getElementById("postTextarea"),postsContainer=document.getElementById("posts");function checkForDeleteButtons(){const e=document.querySelectorAll(".submitDeleteForm");return e.forEach(e=>{e.addEventListener("click",deletePost)}),e}function deletePost(){const e=this.getAttribute("postId"),t=document.getElementById(e);fetch(`/api/posts/delete/?post=${e}`,{method:"DELETE"}).then(e=>e.json()).then(e=>{t.parentNode.removeChild(t),checkForDeleteButtons()}).catch(e=>{const t=document.createElement("div");t.innerHTML='\n        <div class="alert alert-danger alert-dismissible fade show" role="alert">\n          <strong>There was an error!</strong> Try refreshing your page.\n          <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n            <span aria-hidden="true">&times;</span>\n          </button>\n        </div>\n      ',document.body.prepend(t),console.log(e)}),checkForDeleteButtons()}function fetchPosts(){const e=document.getElementById("loader");fetch("/api/posts/fetch").then(e=>e.json()).then(t=>{if(0==t.length){const e=document.createElement("div");e.innerHTML='<h5 id="msg" align="center">We couldn\'t find any posts</h5>',postsContainer.prepend(e)}else t.forEach(e=>{const t=e.text,n=e.author,o=e.authorId,a=e.authorImage,d=e.datefield,c=e._id,m=document.getElementById("posts"),s=document.createElement("div"),r=getCookie("email").toString(),i=getCookie("password").toString();fetch(`/api/accounts/check/?email=${r}&password=${i}`,{method:"PUT"}).then(e=>e.json()).then(r=>{e.authorId==r._id?1==e.hasAttachments?(1==e.attachments.hasAttachedImage&&(s.innerHTML=(new ImageComponent).create(c,a,o,n,t,e.attachments.image.attachedImage,d,{readOnly:!1})),1==e.attachments.hasAttachedVideo&&(s.innerHTML=(new VideoComponent).create(c,a,o,n,t,e.attachments.video.attachedVideo,d,{readOnly:!1})),1==e.attachments.hasAttachedVideo&&1==e.attachments.hasAttachedImage&&(s.innerHTML=(new ComboComponent).create(c,a,o,n,d,t,e.attachments.image.attachedImage,e.attachments.video.attachedVideo,{readOnly:!1}))):s.innerHTML=(new TextComponent).create(c,a,o,n,d,t,{readOnly:!1}):1==e.hasAttachments?(1==e.attachments.hasAttachedImage&&(s.innerHTML=(new ImageComponent).create(c,a,o,n,t,e.attachments.image.attachedImage,d,{readOnly:!0})),1==e.attachments.hasAttachedVideo&&(s.innerHTML=(new VideoComponent).create(c,a,o,n,t,e.attachments.video.attachedVideo,d,{readOnly:!0})),1==e.attachments.hasAttachedImage&&1==e.attachments.hasAttachedVideo&&(s.innerHTML=(new ComboComponent).create(c,a,o,n,d,t,e.attachments.image.attachedImage,e.attachments.video.attachedVideo,{readOnly:!0}))):s.innerHTML=(new TextComponent).create(c,a,o,n,d,t,{readOnly:!0}),m.appendChild(s),checkForDeleteButtons()}).catch(e=>{console.log(e)})});postsContainer.removeChild(e)}).catch(e=>console.log(e))}function createPost(){const e=document.getElementById("imageUpload"),t=document.getElementById("videoUpload"),n=e.files,o=t.files;if(0==n.length&&0==o.length){let n=new FormData;n.append("text",postText.value);let o=new Loader({fullScreen:!0});document.body.appendChild(o),fetch("/api/posts/create?q=txt",{method:"PUT",body:n}).then(e=>e.json()).then(n=>{const a=document.getElementById("msg"),d=n.text,c=n.author,m=n._id,s=n.authorId,r=n.authorImage,i=n.datefield,l=document.getElementById("posts"),h=document.createElement("div");a&&(a.innerHTML=""),h.innerHTML=(new TextComponent).create(m,r,s,c,i,d,{readOnly:!1}),postText.value="",e.value="",t.value="",document.body.removeChild(o),l.prepend(h)}).catch(e=>{console.log(e)}),checkForDeleteButtons()}if(o[0]&&!n[0]){let n=new FormData;n.append("text",postText.value),n.append("video",o[0]);let a=new Loader({fullScreen:!0});document.body.appendChild(a),fetch("/api/posts/create?q=vid",{method:"PUT",body:n}).then(e=>e.json()).then(n=>{const o=document.getElementById("msg"),d=n.text,c=n.author,m=n._id,s=n.authorId,r=n.authorImage,i=n.datefield,l=n.attachments.video.attachedVideo,h=document.getElementById("posts"),p=document.createElement("div");o&&(o.innerHTML=""),p.innerHTML=(new VideoComponent).create(m,r,s,c,d,l,i,{readOnly:!1}),postText.value="",e.value="",t.value="",document.body.removeChild(a),h.prepend(p)}).catch(e=>{console.log(e)}),checkForDeleteButtons()}if(n[0]&&o[0]){let a=new FormData;a.append("text",postText.value),a.append("video",o[0]),a.append("image",n[0]);let d=new Loader({fullScreen:!0});document.body.appendChild(d),fetch("/api/posts/create?q=imgvid",{method:"PUT",body:a}).then(e=>e.json()).then(n=>{const o=document.getElementById("msg"),a=n.text,c=n.author,m=n._id,s=n.authorId,r=n.authorImage,i=n.datefield,l=n.attachments.video.attachedVideo,h=n.attachments.image.attachedImage,p=document.getElementById("posts"),u=document.createElement("div");o&&(o.innerHTML=""),u.innerHTML=(new ComboComponent).create(m,r,s,c,i,a,h,l,{readOnly:!1}),postText.value="",e.value="",t.value="",document.body.removeChild(d),p.prepend(u)}).catch(e=>{console.log(e)}),checkForDeleteButtons()}if(n[0]&&!o[0]){const o=new FormData;o.append("text",postText.value),o.append("image",n[0]);const a=new Loader({fullScreen:!0});document.body.appendChild(a),fetch("/api/posts/create?q=img",{method:"PUT",body:o}).then(e=>e.json()).then(n=>{const o=document.getElementById("msg"),d=n.text,c=n.author,m=n._id,s=n.authorId,r=n.authorImage,i=n.datefield,l=n.attachments.image.attachedImage,h=document.getElementById("posts"),p=document.createElement("div");o&&(o.innerHTML=""),p.innerHTML=(new ImageComponent).create(m,r,s,c,d,l,i,{readOnly:!1}),postText.value="",e.value="",t.value="",document.body.removeChild(a),h.prepend(p)}).catch(e=>{console.log(e)}),checkForDeleteButtons()}}window.addEventListener("load",()=>{const e=new Loader({fullScreen:!1});postsContainer.appendChild(e),fetchPosts()}),postButton.addEventListener("click",createPost);