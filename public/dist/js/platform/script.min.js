const postButton=document.getElementById("postButton"),postText=document.getElementById("postTextarea");function checkForDeleteButtons(){let e=document.querySelectorAll(".submitDeleteForm");return e.forEach(e=>{e.addEventListener("click",deletePost)}),e}function deletePost(){let e=this.getAttribute("postId"),t=document.getElementById(e),n=document.createElement("div");n.innerHTML='\n  <div id="progress" class="progress" style="position: relative;">\n    <div class="progress-bar progress-bar-striped indeterminate  progress-bar-animated bg-danger" style="width: 100%">\n  </div>\n  ',t.prepend(n),fetch(`/api/posts/delete/?post=${e}`,{method:"DELETE"}).then(e=>e.json()).then(e=>{console.log(e),t.parentNode.removeChild(t),checkForDeleteButtons()}).catch(e=>{let t=document.createElement("div");t.innerHTML='\n        <div class="alert alert-danger alert-dismissible fade show" role="alert">\n          <strong>There was an error!</strong> Try refreshing your page.\n          <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n            <span aria-hidden="true">&times;</span>\n          </button>\n        </div>\n      ',document.body.prepend(t),console.log(e)}),checkForDeleteButtons()}function fetchPosts(){fetch("/api/posts/fetch").then(e=>e.json()).then(e=>{if(e.length<1||0==e.length){let e=document.createElement("div");e.innerHTML='\n        <h5 id="msg" align="center">We couldn\'t find any posts <br /><br /></h5>\n        ';let t=document.getElementById("posts");t.prepend(e),t.removeChild(document.getElementById("loader"))}else e.forEach(e=>{let t=e.text,n=e.author,a=e.authorId,s=e.authorImage,o=e.datefield,l=e._id,d=document.getElementById("posts"),i=document.createElement("div"),r=getCookie("email").toString(),c=getCookie("password").toString();fetch(`/api/accounts/check/?email=${r}&password=${c}`,{method:"PUT",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(e=>e.json()).then(d=>{e.authorId==d._id?1==e.hasAttachments?(1==e.attachments.hasAttachedImage&&(i.innerHTML=`\n                    <div id="${l}" class="post container shadow-sm rounded-lg mt-1 mb-4 pr-4 pl-4 pb-3 pt-3 bg-white">\n                      <i style="float: right" postId="${l}" class="submitDeleteForm fas fa-trash-alt p-2" role="button"></i>\n                      <img\n                        src="${s}"\n                        alt="profile-photo"\n                        class="rounded-circle"\n                        width= "50"\n                        height="50"\n                      />\n                      <h4 class="text-dark mt-3 align-baseline">\n                        <a href="/user/${a}">${n}</a>\n                      </h4>\n                      <h6 class="text-dark align-baseline">\n                        ${t}\n                      </h6>\n                      <div class="container p-2">\n                        <img src="${e.attachments.image.attachedImage}" width="500" alt="image" />\n                      </div>\n                      <h6 class="text-secondary">${o}</h6>\n                    </div>\n                    `),1==e.attachments.hasAttachedVideo&&(i.innerHTML=`\n                    <div id="${l}" class="post container shadow-sm rounded-lg mt-1 mb-4 pr-4 pl-4 pb-3 pt-3 bg-white">\n                      <i style="float: right" postId="${l}" class="submitDeleteForm fas fa-trash-alt p-2" role="button"></i>\n                      <img\n                        src="${s}"\n                        alt="profile-photo"\n                        class="rounded-circle"\n                        width= "50"\n                        height="50"\n                      />\n                      <h4 class="text-dark mt-3 align-baseline">\n                        <a href="/user/${a}">${n}</a>\n                      </h4>\n                      <h6 class="text-dark align-baseline">\n                        ${t}\n                      </h6>\n                      <div class="container p-2">\n                        <video\n                        class="video-js vjs-theme-city"\n                        \n                        controls\n                        preload="auto"\n                        width= "500"\n                        height="500"\n                        \n                        data-setup="{}"\n                      >\n                        <source src="${e.attachments.video.attachedVideo}"/>\n                        <p class="vjs-no-js">\n                          To view this video please enable JavaScript, and consider upgrading to a\n                          web browser that\n                          <a href="https://videojs.com/html5-video-support/" target="_blank"\n                            >supports HTML5 video</a\n                          >\n                        </p>\n                      </video>\n                      </div>\n                      <h6 class="text-secondary">${o}</h6>\n                    </div>\n                    `),1==e.attachments.hasAttachedVideo&&1==e.attachments.hasAttachedImage&&(i.innerHTML=`\n                    <div id="${l}" class="post container shadow-sm rounded-lg mt-1 mb-4 pr-4 pl-4 pb-3 pt-3 bg-white">\n                      <i style="float: right" postId="${l}" class="submitDeleteForm fas fa-trash-alt p-2" role="button"></i>\n                      <img\n                        src="${s}"\n                        alt="profile-photo"\n                        class="rounded-circle"\n                        width= "50"\n                        height="50"\n                      />\n                      <h4 class="text-dark mt-3 align-baseline">\n                        <a href="/user/${a}">${n}</a>\n                      </h4>\n                      <h6 class="text-dark align-baseline">\n                        ${t}\n                      </h6>\n                      <div class="container p-2">\n                        <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">\n                          <div class="carousel-inner">\n                            <div class="carousel-item active">\n                            <video\n                            class="video-js vjs-theme-city"\n                            \n                            controls\n                            preload="auto"\n                            width="500"\n                            height="500"\n                            \n                            data-setup="{}"\n                          >\n                            <source src="${e.attachments.video.attachedVideo}"/>\n                            <p class="vjs-no-js">\n                              To view this video please enable JavaScript, and consider upgrading to a\n                              web browser that\n                              <a href="https://videojs.com/html5-video-support/" target="_blank"\n                                >supports HTML5 video</a\n                              >\n                            </p>\n                          </video>\n                              \n                            </div>\n                            <div class="carousel-item">\n                              <img src="${e.attachments.image.attachedImage}" class="d-block w-100" alt="...">\n                            </div>\n                          <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">\n                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>\n                            <span class="sr-only">Previous</span>\n                          </a>\n                          <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">\n                            <span class="carousel-control-next-icon" aria-hidden="true"></span>\n                            <span class="sr-only">Next</span>\n                          </a>\n                        </div>\n                      </div>\n                      <h6 class="text-secondary">${o}</h6>\n                    </div>\n                    `)):i.innerHTML=`\n                  <div id="${l}" class="post container shadow-sm rounded-lg mt-1 mb-4 pr-4 pl-4 pb-3 pt-3 bg-white">\n                    <i style="float: right" postId="${l}" class="submitDeleteForm fas fa-trash-alt p-2" role="button"></i>\n                    <img\n                      src="${s}"\n                      alt="profile-photo"\n                      class="rounded-circle"\n                      width= "50"\n                      height="50"\n                    />\n                    <h4 class="text-dark mt-3 align-baseline">\n                      <a href="/user/${a}">${n}</a>\n                    </h4>\n                    <h6 class="text-dark align-baseline">\n                      ${t}\n                    </h6>\n                    <h6 class="text-secondary">${o}</h6>\n                  </div>\n                  `:1==e.hasAttachments?(1==e.attachments.hasAttachedImage&&(i.innerHTML=`\n                    <div id="${l}" class="post container shadow-sm rounded-lg mt-1 mb-4 pr-4 pl-4 pb-3 pt-3 bg-white">\n                      <img\n                        src="${s}"\n                        alt="profile-photo"\n                        class="rounded-circle"\n                        width= "50"\n                        height="50"\n                      />\n                      <h4 class="text-dark mt-3 align-baseline">\n                        <a href="/user/${a}">${n}</a>\n                      </h4>\n                      <h6 class="text-dark align-baseline">\n                        ${t}\n                      </h6>\n                      <div class="container p-2">\n                        <img src="${e.attachments.image.attachedImage}" width="500" alt="image" />\n                      </div>\n                      <h6 class="text-secondary">${o}</h6>\n                    </div>\n                    `),1==e.attachments.hasAttachedVideo&&(i.innerHTML=`\n                    <div id="${l}" class="post container shadow-sm rounded-lg mt-1 mb-4 pr-4 pl-4 pb-3 pt-3 bg-white">\n                      <img\n                        src="${s}"\n                        alt="profile-photo"\n                        class="rounded-circle"\n                        width= "50"\n                        height="50"\n                      />\n                      <h4 class="text-dark mt-3 align-baseline">\n                        <a href="/user/${a}">${n}</a>\n                      </h4>\n                      <h6 class="text-dark align-baseline">\n                        ${t}\n                      </h6>\n                      <div class="container p-2">\n                      <video\n                      class="video-js vjs-theme-city"\n                      \n                      controls\n                      preload="auto"\n                      width="500"\n                      height="500"\n                      \n                      data-setup="{}"\n                    >\n                      <source src="${e.attachments.video.attachedVideo}"/>\n                      <p class="vjs-no-js">\n                        To view this video please enable JavaScript, and consider upgrading to a\n                        web browser that\n                        <a href="https://videojs.com/html5-video-support/" target="_blank"\n                          >supports HTML5 video</a\n                        >\n                      </p>\n                    </video>\n                      </div>\n                      <h6 class="text-secondary">${o}</h6>\n                    </div>\n                    `),1==e.attachments.hasAttachedImage&&1==e.attachments.hasAttachedVideo&&(i.innerHTML=`\n                    <div id="${l}" class="post container shadow-sm rounded-lg mt-1 mb-4 pr-4 pl-4 pb-3 pt-3 bg-white">\n                      <img\n                        src="${s}"\n                        alt="profile-photo"\n                        class="rounded-circle"\n                        width= "50"\n                        height="50"\n                      />\n                      <h4 class="text-dark mt-3 align-baseline">\n                        <a href="/user/${a}">${n}</a>\n                      </h4>\n                      <h6 class="text-dark align-baseline">\n                        ${t}\n                      </h6>\n                      <div class="container p-2">\n                        <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">\n                          <div class="carousel-inner">\n                            <div class="carousel-item active">\n                            <video\n                            class="video-js vjs-theme-city"\n                            \n                            controls\n                            preload="auto"\n                            width="500"\n                            height="500"\n                            \n                            data-setup="{}"\n                          >\n                            <source src="${e.attachments.video.attachedVideo}"/>\n                            <p class="vjs-no-js">\n                              To view this video please enable JavaScript, and consider upgrading to a\n                              web browser that\n                              <a href="https://videojs.com/html5-video-support/" target="_blank"\n                                >supports HTML5 video</a\n                              >\n                            </p>\n                          </video>\n                            </div>\n                            <div class="carousel-item">\n                              <img src="${e.attachments.image.attachedImage}" class="d-block w-100" alt="...">\n                            </div>\n                          <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">\n                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>\n                            <span class="sr-only">Previous</span>\n                          </a>\n                          <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">\n                            <span class="carousel-control-next-icon" aria-hidden="true"></span>\n                            <span class="sr-only">Next</span>\n                          </a>\n                        </div>\n                      </div>\n                      <h6 class="text-secondary">${o}</h6>\n                    </div>\n                    `)):i.innerHTML=`\n                  <div id="${l}" class="post container shadow-sm rounded-lg mt-1 mb-4 pr-4 pl-4 pb-3 pt-3 bg-white">\n                  <img\n                    src="${s}"\n                    alt="profile-photo"\n                    class="rounded-circle"\n                    width= "50"\n                    height="50"\n                  />\n                  <h4 class="text-dark mt-3 align-baseline">\n                    <a href="/user/${a}">${n}</a>\n                  </h4>\n                  <h6 class="text-dark align-baseline">\n                    ${t}\n                  </h6>\n                  <h6 class="text-secondary">${o}</h6>\n                </div>\n                  `,checkForDeleteButtons(),postText.value="",document.getElementById("loader").innerHTML=""}).catch(e=>{console.log(e)}),d.prepend(i)})}).catch(e=>console.log(e))}function createPost(){let e=document.getElementById("imageUpload"),t=document.getElementById("videoUpload"),n=e.files,a=t.files;if(0==n.length&&0==a.length){let n=new FormData;n.append("text",postText.value);let a=document.createElement("div");a.classList.add("full-loader"),a.classList.add("full-loader-default"),a.classList.add("is-active"),document.body.appendChild(a),fetch("/api/posts/create?q=txt",{method:"PUT",body:n}).then(e=>e.json()).then(n=>{let s=document.getElementById("msg"),o=n.text,l=n.author,d=n._id,i=n.authorId,r=n.authorImage,c=n.datefield,h=document.getElementById("posts"),p=document.createElement("div");s&&(s.innerHTML=""),p.innerHTML=`\n        <div id="${d}" class="post container shadow-sm rounded-lg mt-1 mb-4 pr-4 pl-4 pb-3 pt-3 bg-white">\n          <i style="float: right" postId="${d}" class="submitDeleteForm fas fa-trash-alt p-2" role="button"></i>\n          <img\n            src="${r}"\n            alt="profile-photo"\n            class="rounded-circle"\n            width= "50"\n            height="50"\n          />\n          <h4 class="text-dark mt-3 align-baseline">\n            <a href="/user/${i}">${l}</a>\n          </h4>\n          <h6 class="text-dark align-baseline">\n            ${o}\n          </h6>\n          <h6 class="text-secondary">${c}</h6>\n        </div>\n      `,h.prepend(p),document.body.removeChild(a),e=null,t=null,postText.value="",checkForDeleteButtons()}).catch(e=>{console.log(e)}),checkForDeleteButtons()}if(a[0]&&!n[0]){let n=new FormData;n.append("text",postText.value),n.append("video",a[0]);let s=document.createElement("div");s.classList.add("full-loader"),s.classList.add("full-loader-default"),s.classList.add("is-active"),document.body.appendChild(s),fetch("/api/posts/create?q=vid",{method:"PUT",body:n}).then(e=>e.json()).then(n=>{let a=document.getElementById("msg"),o=n.text,l=n.author,d=n._id,i=n.authorId,r=n.authorImage,c=n.datefield,h=n.attachments.video.attachedVideo,p=document.getElementById("posts"),m=document.createElement("div");a&&(a.innerHTML=""),m.innerHTML=`\n      <div id="${d}" class="post container shadow-sm rounded-lg mt-1 mb-4 pr-4 pl-4 pb-3 pt-3 bg-white">\n        <i style="float: right" postId="${d}" class="submitDeleteForm fas fa-trash-alt p-2" role="button"></i>\n        <img\n          src="${r}"\n          alt="profile-photo"\n          class="rounded-circle"\n          width= "50"\n          height="50"\n        />\n        <h4 class="text-dark mt-3 align-baseline">\n          <a href="/user/${i}">${l}</a>\n        </h4>\n        <h6 class="text-dark align-baseline">\n          ${o}\n        </h6>\n        <div class="container p-2">\n        <video\n        class="video-js vjs-theme-city"\n        \n        controls\n        preload="auto"\n        width="500"\n        height="500"\n        \n        data-setup="{}"\n      >\n        <source src="${h}"/>\n        <p class="vjs-no-js">\n          To view this video please enable JavaScript, and consider upgrading to a\n          web browser that\n          <a href="https://videojs.com/html5-video-support/" target="_blank"\n            >supports HTML5 video</a\n          >\n        </p>\n      </video>\n        </div>\n        <h6 class="text-secondary">${c}</h6>\n      </div>\n      `,p.prepend(m),document.body.removeChild(s),e=null,t=null,postText.value="",checkForDeleteButtons()}).catch(e=>{console.log(e)})}if(n[0]&&a[0]){let s=new FormData;s.append("text",postText.value),s.append("video",a[0]),s.append("image",n[0]);let o=document.createElement("div");o.classList.add("full-loader"),o.classList.add("full-loader-default"),o.classList.add("is-active"),document.body.appendChild(o),fetch("/api/posts/create?q=imgvid",{method:"PUT",body:s}).then(e=>e.json()).then(n=>{let a=document.getElementById("msg"),s=n.text,l=n.author,d=n._id,i=n.authorId,r=n.authorImage,c=n.datefield,h=n.attachments.video.attachedVideo,p=n.attachments.image.attachedImage,m=document.getElementById("posts"),u=document.createElement("div");a&&(a.innerHTML=""),u.innerHTML=`\n          <div id="${d}" class="post container shadow-sm rounded-lg mt-1 mb-4 pr-4 pl-4 pb-3 pt-3 bg-white">\n            <i style="float: right" postId="${d}" class="submitDeleteForm fas fa-trash-alt p-2" role="button"></i>\n            <img\n              src="${r}"\n              alt="profile-photo"\n              class="rounded-circle"\n              width= "50"\n              height="50"\n            />\n            <h4 class="text-dark mt-3 align-baseline">\n              <a href="/user/${i}">${l}</a>\n            </h4>\n            <h6 class="text-dark align-baseline">\n              ${s}\n            </h6>\n            <div class="container p-2">\n              <div id="carouselExampleControls" class="carousel slide" data-ride="carousel">\n                <div class="carousel-inner">\n                  <div class="carousel-item active">\n                  <video\n                  class="video-js vjs-theme-city"\n                  \n                  style="margin: 0 auto"\n                  controls\n                  preload="auto"\n                  width="500"\n                  height="500"\n                  \n                  data-setup="{}"\n                >\n                  <source src="${h}"/>\n                  <p class="vjs-no-js">\n                    To view this video please enable JavaScript, and consider upgrading to a\n                    web browser that\n                    <a href="https://videojs.com/html5-video-support/" target="_blank"\n                      >supports HTML5 video</a\n                    >\n                  </p>\n                </video>\n                  </div>\n                  <div class="carousel-item">\n                    <img src="${p}" class="d-block w-100" alt="...">\n                  </div>\n                <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-slide="prev">\n                  <span class="carousel-control-prev-icon" aria-hidden="true"></span>\n                  <span class="sr-only">Previous</span>\n                </a>\n                <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-slide="next">\n                  <span class="carousel-control-next-icon" aria-hidden="true"></span>\n                  <span class="sr-only">Next</span>\n                </a>\n              </div>\n            </div>\n            <h6 class="text-secondary">${c}</h6>\n          </div>\n        `,m.prepend(u),document.body.removeChild(o),e=null,t=null,postText.value="",checkForDeleteButtons()}).catch(e=>{console.log(e)})}if(n[0]&&!a[0]){let a=new FormData;a.append("text",postText.value),a.append("image",n[0]);let s=document.createElement("div");s.classList.add("full-loader"),s.classList.add("full-loader-default"),s.classList.add("is-active"),document.body.appendChild(s),fetch("/api/posts/create?q=img",{method:"PUT",body:a}).then(e=>e.json()).then(n=>{let a=document.getElementById("msg"),o=n.text,l=n.author,d=n._id,i=n.authorId,r=n.authorImage,c=n.datefield,h=n.attachments.image.attachedImage,p=document.getElementById("posts"),m=document.createElement("div");postText.value="",a&&(a.innerHTML=""),m.innerHTML=`\n        <div id="${d}" class="post container shadow-sm rounded-lg mt-1 mb-4 pr-4 pl-4 pb-3 pt-3 bg-white">\n          <i style="float: right" postId="${d}" class="submitDeleteForm fas fa-trash-alt p-2" role="button"></i>\n          <img\n            src="${r}"\n            alt="profile-photo"\n            class="rounded-circle"\n            width= "50"\n            height="50"\n          />\n          <h4 class="text-dark mt-3 align-baseline">\n            <a href="/user/${i}">${l}</a>\n          </h4>\n          <h6 class="text-dark align-baseline">\n            ${o}\n          </h6>\n          <div class="container p-2">\n            <img src="${h}" width="500" alt="image" />\n          </div>\n          <h6 class="text-secondary">${c}</h6>\n        </div>\n        `,p.prepend(m),document.body.removeChild(s),e=null,t=null,postText.value="",checkForDeleteButtons()}).catch(e=>{console.log(e)})}}window.addEventListener("load",()=>{loader(),fetchPosts()}),postButton.addEventListener("click",createPost);
