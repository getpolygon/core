import ImageComponent from"/components/image-component.mjs";import VideoComponent from"/components/video-component.mjs";import ComboComponent from"/components/combo-component.mjs";import TextComponent from"/components/text-component.mjs";const postButton=document.getElementById("postButton"),postText=document.getElementById("postTextarea"),addFriendButton=document.getElementById("addFriend"),accountId=document.getElementById("accountId").textContent;function checkForDeleteButtons(){let e=document.querySelectorAll(".submitDeleteForm");return e.forEach(e=>{e.addEventListener("click",deletePost)}),e}function deletePost(){let e=this.getAttribute("postId"),t=document.getElementById(e),n=document.createElement("div");n.innerHTML='\n<div id="progress" class="progress" style="position: relative;">\n  <div class="progress-bar progress-bar-striped indeterminate  progress-bar-animated bg-danger" style="width: 100%">\n</div>\n',t.prepend(n),fetch(`/api/posts/delete/?post=${e}`,{method:"DELETE"}).then(e=>e.json()).then(e=>{t.parentNode.removeChild(t),checkForDeleteButtons()}).catch(e=>{let t=document.createElement("div");t.innerHTML='\n      <div class="alert alert-danger alert-dismissible fade show" role="alert">\n        <strong>There was an error!</strong> Try refreshing your page.\n        <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n          <span aria-hidden="true">&times;</span>\n        </button>\n      </div>\n    ',document.body.prepend(t),console.log(e)}),checkForDeleteButtons()}function fetchPosts(){fetch(`/api/posts/fetch/?accountId=${accountId}`).then(e=>e.json()).then(e=>{if(e.length<1||0==e.length){let e=document.createElement("div");e.innerHTML='\n      <h5 id="msg" align="center">We couldn\'t find any posts <br /><br /></h5>\n      ';let t=document.getElementById("posts");t.prepend(e),t.removeChild(document.getElementById("loader"))}else e.forEach(e=>{let t=e.text,n=e.author,a=e.authorId,o=e.authorImage,d=e.datefield,c=e._id,s=document.getElementById("posts"),l=document.createElement("div"),i=getCookie("email").toString(),r=getCookie("password").toString();fetch(`/api/accounts/check/?email=${i}&password=${r}`,{method:"PUT"}).then(e=>e.json()).then(i=>{e.authorId==i._id?1==e.hasAttachments?(1==e.attachments.hasAttachedImage&&(l.innerHTML=(new ImageComponent).create(c,o,a,n,t,e.attachments.image.attachedImage,d,{readOnly:!1})),1==e.attachments.hasAttachedVideo&&(l.innerHTML=(new VideoComponent).create(c,o,a,n,t,e.attachments.video.attachedVideo,d,{readOnly:!1})),1==e.attachments.hasAttachedVideo&&1==e.attachments.hasAttachedImage&&(l.innerHTML=(new ComboComponent).create(c,o,a,n,d,t,e.attachments.image.attachedImage,e.attachments.video.attachedVideo,{readOnly:!1}))):l.innerHTML=(new TextComponent).create(c,o,a,n,d,t,{readOnly:!1}):1==e.hasAttachments?(1==e.attachments.hasAttachedImage&&(l.innerHTML=(new ImageComponent).create(c,o,a,n,t,e.attachments.image.attachedImage,d,{readOnly:!0})),1==e.attachments.hasAttachedVideo&&(l.innerHTML=(new VideoComponent).create(c,o,a,n,t,e.attachments.video.attachedVideo,d,{readOnly:!0})),1==e.attachments.hasAttachedImage&&1==e.attachments.hasAttachedVideo&&(l.innerHTML=(new ComboComponent).create(c,o,a,n,d,t,e.attachments.image.attachedImage,e.attachments.video.attachedVideo,{readOnly:!0}))):l.innerHTML=(new TextComponent).create(c,o,a,n,d,t,{readOnly:!0}),s.appendChild(l),document.getElementById("loader").innerHTML="",checkForDeleteButtons()}).catch(e=>{console.log(e)})})}).catch(e=>console.log(e))}function createPost(){let e=document.getElementById("imageUpload"),t=document.getElementById("videoUpload"),n=e.files,a=t.files;if(0==n.length&&0==a.length){let n=new FormData;n.append("text",postText.value);let a=document.createElement("div");a.classList.add("full-loader"),a.classList.add("full-loader-default"),a.classList.add("is-active"),document.body.appendChild(a),fetch("/api/posts/create?q=txt",{method:"PUT",body:n}).then(e=>e.json()).then(n=>{let o=document.getElementById("msg"),d=n.text,c=n.author,s=n._id,l=n.authorId,i=n.authorImage,r=n.datefield,m=document.getElementById("posts"),h=document.createElement("div");o&&(o.innerHTML=""),h.innerHTML=(new TextComponent).create(s,i,l,c,r,d,{readOnly:!1}),postText.value="",e.value="",t.value="",document.body.removeChild(a),m.prepend(h)}).catch(e=>{console.log(e)}),checkForDeleteButtons()}if(a[0]&&!n[0]){let n=new FormData;n.append("text",postText.value),n.append("video",a[0]);let o=document.createElement("div");o.classList.add("full-loader"),o.classList.add("full-loader-default"),o.classList.add("is-active"),document.body.appendChild(o),fetch("/api/posts/create?q=vid",{method:"PUT",body:n}).then(e=>e.json()).then(n=>{let a=document.getElementById("msg"),d=n.text,c=n.author,s=n._id,l=n.authorId,i=n.authorImage,r=n.datefield,m=n.attachments.video.attachedVideo,h=document.getElementById("posts"),u=document.createElement("div");a&&(a.innerHTML=""),u.innerHTML=(new VideoComponent).create(s,i,l,c,d,m,r,{readOnly:!1}),postText.value="",e.value="",t.value="",document.body.removeChild(o),h.prepend(u)}).catch(e=>{console.log(e)}),checkForDeleteButtons()}if(n[0]&&a[0]){let o=new FormData;o.append("text",postText.value),o.append("video",a[0]),o.append("image",n[0]);let d=document.createElement("div");d.classList.add("full-loader"),d.classList.add("full-loader-default"),d.classList.add("is-active"),document.body.appendChild(d),fetch("/api/posts/create?q=imgvid",{method:"PUT",body:o}).then(e=>e.json()).then(n=>{let a=document.getElementById("msg"),o=n.text,c=n.author,s=n._id,l=n.authorId,i=n.authorImage,r=n.datefield,m=n.attachments.video.attachedVideo,h=n.attachments.image.attachedImage,u=document.getElementById("posts"),p=document.createElement("div");a&&(a.innerHTML=""),p.innerHTML=(new ComboComponent).create(s,i,l,c,r,o,h,m,{readOnly:!1}),postText.value="",e.value="",t.value="",document.body.removeChild(d),u.prepend(p)}).catch(e=>{console.log(e)}),checkForDeleteButtons()}if(n[0]&&!a[0]){let a=new FormData;a.append("text",postText.value),a.append("image",n[0]);let o=document.createElement("div");o.classList.add("full-loader"),o.classList.add("full-loader-default"),o.classList.add("is-active"),document.body.appendChild(o),fetch("/api/posts/create?q=img",{method:"PUT",body:a}).then(e=>e.json()).then(n=>{let a=document.getElementById("msg"),d=n.text,c=n.author,s=n._id,l=n.authorId,i=n.authorImage,r=n.datefield,m=n.attachments.image.attachedImage,h=document.getElementById("posts"),u=document.createElement("div");a&&(a.innerHTML=""),u.innerHTML=(new ImageComponent).create(s,i,l,c,d,m,r,{readOnly:!1}),postText.value="",e.value="",t.value="",document.body.removeChild(o),h.prepend(u)}).catch(e=>{console.log(e)}),checkForDeleteButtons()}}function addFriend(){let e=document.getElementById("accountId").textContent;fetch(`/api/friends/add/?addedAccount=${e}`,{method:"PUT"}).then(e=>e.json()).then(e=>{addFriendButton.innerText="Pending",addFriendButton.innerHTML+='\n      <i class="fas fa-user-clock"></i>\n      ',addFriendButton.setAttribute("disabled","true"),console.log(e)}).catch(e=>console.error(e))}function checkFriendship(){fetch(`/api/friends/check/?accountId=${accountId}`).then(e=>e.json()).then(e=>{0!=e.length?(addFriendButton.innerText="Pending",addFriendButton.innerHTML+='\n          <i class="fas fa-user-clock"></i>\n          ',addFriendButton.setAttribute("disabled","true")):addFriendButton=addFriendButton})}window.addEventListener("load",()=>{if(checkFriendship(),loader(),fetchPosts(),checkForDeleteButtons(),null==postButton)return null;postButton.addEventListener("click",createPost)}),addFriendButton.addEventListener("click",addFriend);