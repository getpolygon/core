let postButton=document.getElementById("postButton"),postText=document.getElementById("postTextarea"),postCount=document.getElementById("postCount"),addFriendButton=document.getElementById("addFriend"),accountId=document.getElementById("accountId").textContent;function checkForDeleteButtons(){let e=document.querySelectorAll(".submitDeleteForm");return e.forEach(e=>{e.addEventListener("click",deletePost)}),e}function deletePost(){let e=document.getElementById(this.parentNode.id),t=this.getAttribute("postId"),n=document.createElement("div");n.innerHTML='\n  <div id="progress" class="progress" style="position: relative;">\n    <div class="progress-bar progress-bar-striped indeterminate  progress-bar-animated bg-danger" style="width: 100%">\n  </div>\n  ',e.prepend(n),fetch(`/api/posts/delete?post=${t}`,{method:"DELETE"}).then(e=>e.json()).then(t=>{e.parentNode.removeChild(e),checkForDeleteButtons()}).catch(e=>{let t=document.createElement("div");t.innerHTML='\n        <div class="alert alert-danger alert-dismissible fade show" role="alert">\n          <strong>There was an error!</strong> Try refreshing your page.\n          <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n            <span aria-hidden="true">&times;</span>\n          </button>\n        </div>\n      ',document.body.prepend(t),console.log(e)}),checkForDeleteButtons()}function fetchPosts(){fetch(`/api/posts/fetch/?accountId=${accountId}`).then(e=>e.json()).then(e=>{if(e.length<1||0==e.length){let e=document.createElement("div");e.innerHTML='\n        <h5 id="msg" align="center">We couldn\'t find any posts <br /><br /></h5>\n        ';let t=document.getElementById("posts");t.prepend(e),t.removeChild(document.getElementById("loader"))}else e.forEach(e=>{let t=e.text,n=e.author,d=e.authorId,a=e.authorImage,s=e.datefield,o=e._id,l=e.attachedImage,i=document.getElementById("posts"),r=document.createElement("div"),c=getCookie("email").toString(),h=getCookie("password").toString();fetch(`/api/accounts/check/?email=${c}&password=${h}`,{method:"PUT"}).then(e=>e.json()).then(i=>{e.authorId==i._id?(r.innerHTML=l?`\n                <div id="${o}" class="post container shadow-sm rounded-lg mt-1 mb-4 pr-4 pl-4 pb-3 pt-3 bg-white">\n                  <i style="float: right" postId="${o}" class="submitDeleteForm fas fa-trash-alt" role="button"></i>\n                  <img\n                    src="${a}"\n                    alt="profile-photo"\n                    class="rounded-circle"\n                    width= "50"\n                    height="50"\n                  />\n                  <h5 class="text-dark mt-3 align-baseline">\n                    <a href="/user/${d}">${n}</a>\n                  </h5>\n                  <h6 class="text-dark align-baseline">\n                    ${t}\n                  </h6>\n                  <div class="container p-2">\n                    <img src="${l}" width="500" alt="image" />\n                  </div>\n                  <h6 class="text-secondary">${s}</h6>\n              </div>\n              `:`\n                <div id="${o}" class="post container shadow-sm rounded-lg mt-1 mb-4 pr-4 pl-4 pb-3 pt-3 bg-white">\n                  <i style="float: right" postId="${o}" class="submitDeleteForm fas fa-trash-alt" role="button"></i>\n                  <img\n                    src="${a}"\n                    alt="profile-photo"\n                    class="rounded-circle"\n                    width= "50"\n                    height="50"\n                  />\n                  <h5 class="text-dark mt-3 align-baseline">\n                    <a href="/user/${d}">${n}</a>\n                  </h5>\n                  <h6 class="text-dark align-baseline">\n                    ${t}\n                  </h6>\n                  <h6 class="text-secondary">${s}</h6>\n              </div>\n              `,checkForDeleteButtons()):(r.innerHTML=l?`\n              <div id="${o}" class="post container shadow-sm rounded-lg mt-1 mb-4 pr-4 pl-4 pb-3 pt-3 bg-white">\n                <img\n                  src="${a}"\n                  alt="profile-photo"\n                  class="rounded-circle"\n                  width= "50"\n                  height="50"\n                />\n                <h5 class="text-dark mt-3 align-baseline">\n                  <a href="/user/${d}">${n}</a>\n                </h5>\n                <h6 class="text-dark align-baseline">\n                  ${t}\n                </h6>\n                <div class="container p-2">\n                <img src="${l}" width="500" alt="image" />\n                  </div>\n                <h6 class="text-secondary">${s}</h6>\n            </div>\n          `:`\n            <div id="${o}" class="post container shadow-sm rounded-lg mt-1 mb-4 pr-4 pl-4 pb-3 pt-3 bg-white">\n              <img\n                src="${a}"\n                alt="profile-photo"\n                class="rounded-circle"\n                width= "50"\n                height="50"\n              />\n              <h5 class="text-dark mt-3 align-baseline">\n                <a href="/user/${d}">${n}</a>\n              </h5>\n              <h6 class="text-dark align-baseline">\n                ${t}\n              </h6>\n              <h6 class="text-secondary">${s}</h6>\n          </div>\n        `,checkForDeleteButtons()),document.getElementById("loader").innerHTML=""}).catch(e=>{console.log(e)}),i.prepend(r)})}).catch(e=>console.log(e))}function createPost(){let e=document.getElementById("imageUpload"),t=e.files[0];if(null==t){let e=new FormData;e.append("text",postText.value);let t=document.createElement("div");t.classList.add("full-loader"),t.classList.add("full-loader-default"),t.classList.add("is-active"),document.body.appendChild(t),fetch("/api/posts/create",{method:"PUT",body:e}).then(e=>e.json()).then(e=>{let n=document.getElementById("msg"),d=e.text,a=e.author,s=e._id,o=e.authorId,l=e.authorImage,i=e.datefield,r=document.getElementById("posts"),c=document.createElement("div");n&&(n.innerHTML=""),postText.value="",c.innerHTML=`\n        <div id="${s}" class="post container shadow-sm rounded-lg mt-1 mb-4 pr-4 pl-4 pb-3 pt-3 bg-white">\n          <i style="float: right" postId="${s}" class="submitDeleteForm fas fa-trash-alt p-2" role="button"></i>\n          <img\n            src="${l}"\n            alt="profile-photo"\n            class="rounded-circle"\n            width= "50"\n            height="50"\n          />\n          <h4 class="text-dark mt-3 align-baseline">\n            <a href="/user/${o}">${a}</a>\n          </h4>\n          <h6 class="text-dark align-baseline">\n            ${d}\n          </h6>\n          <h6 class="text-secondary">${i}</h6>\n        </div>\n      `,r.prepend(c),document.body.removeChild(t),checkForDeleteButtons()}).catch(e=>{console.log(e)})}else{let n=new FormData;n.append("text",postText.value),n.append("image",t);let d=document.createElement("div");d.classList.add("full-loader"),d.classList.add("full-loader-default"),d.classList.add("is-active"),document.body.appendChild(d),fetch("/api/posts/create",{method:"PUT",body:n}).then(e=>e.json()).then(t=>{let n=document.getElementById("msg"),a=t.text,s=t.author,o=t._id,l=t.authorId,i=t.authorImage,r=t.datefield,c=t.attachedImage,h=document.getElementById("posts"),u=document.createElement("div");postText.value="",n&&(n.innerHTML=""),u.innerHTML=`\n        <div id="${o}" class="post container shadow-sm rounded-lg mt-1 mb-4 pr-4 pl-4 pb-3 pt-3 bg-white">\n          <i style="float: right" postId="${o}" class="submitDeleteForm fas fa-trash-alt p-2" role="button"></i>\n          <img\n            src="${i}"\n            alt="profile-photo"\n            class="rounded-circle"\n            width= "50"\n            height="50"\n          />\n          <h4 class="text-dark mt-3 align-baseline">\n            <a href="/user/${l}">${s}</a>\n          </h4>\n          <h6 class="text-dark align-baseline">\n            ${a}\n          </h6>\n          <div class="container p-2">\n            <img src="${c}" width="500" alt="image" />\n          </div>\n          <h6 class="text-secondary">${r}</h6>\n        </div>\n        `,e="",h.prepend(u),document.body.removeChild(d),checkForDeleteButtons()}).catch(e=>{console.log(e)})}}function addFriend(){let e=document.getElementById("accountId").textContent;fetch(`/api/friends/add/?addedAccount=${e}`,{method:"PUT"}).then(e=>e.json()).then(e=>{addFriendButton.innerText="Pending",addFriendButton.innerHTML+='\n      <i class="fas fa-user-clock"></i>\n      ',addFriendButton.setAttribute("disabled","true"),console.log(e)}).catch(e=>console.error(e))}async function checkFriendship(){let e=document.getElementById("accountId").textContent;0!=(await fetch(`/api/friends/check/?accountId=${e}`)).length?(addFriendButton.innerText="Pending",addFriendButton.innerHTML+='\n        <i class="fas fa-user-clock"></i>\n        ',addFriendButton.setAttribute("disabled","true")):addFriendButton=addFriendButton}window.addEventListener("load",()=>{if(checkFriendship(),loader(),fetchPosts(),checkForDeleteButtons(),null==postButton)return null;postButton.addEventListener("click",createPost)}),addFriendButton.addEventListener("click",addFriend);